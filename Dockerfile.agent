# Dedicated Agent Container
FROM python:3.11-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    ca-certificates \
    net-tools \
    iputils-ping \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy only agent-specific code
COPY app/core/ /app/app/core/
COPY app/services/ /app/app/services/
COPY app/config.py /app/app/
COPY app/dependencies.py /app/app/
COPY app/__init__.py /app/app/

# Create agent runner script
COPY agent_runner.py /app/

# Environment variables
ENV PYTHONPATH=/app
ENV AGENT_TYPE=trading
ENV REDIS_URL=redis://redis:6379
ENV CENTRAL_MANAGER_URL=http://app:8000

# Expose port for agent communication
EXPOSE 8001

# Add label for agent capability detection
LABEL autogen.agent.capable="true"

# Run the agent
CMD ["python", "agent_runner.py"]